<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ServiceHub - Find Trusted Tradespeople</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Additional styles for location search */
        .location-results {
            border: 1px solid #ddd;
            border-radius: 4px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 5px;
        }
        
        .location-result {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }
        
        .location-result:hover {
            background-color: #f5f5f5;
        }
        
        .location-result:last-child {
            border-bottom: none;
        }
        
        .form-text {
            font-size: 0.85em;
            color: #6c757d;
            margin-top: 5px;
        }
        
        .listing-price {
            font-weight: bold;
            color: var(--primary);
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <a href="#" class="logo">
                    <i class="fas fa-handshake"></i>
                    ServiceHub
                </a>
                <div class="auth-container">
                    <div class="user-welcome" id="userWelcome">
                        <span>Welcome, <span id="userName"></span></span>
                        <button class="btn btn-danger" id="logoutBtn">Logout</button>
                    </div>
                    <div id="authButtons">
                        <button class="btn btn-outline" id="loginBtn">Login</button>
                        <button class="btn btn-primary" id="registerBtn">Register</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1>Find Trusted Tradespeople for Any Project</h1>
            <p>Connect with local tradespeople for all your home improvement needs - from plumbing to electrical work</p>
            <button class="btn btn-primary" id="heroBtn">Get Started</button>
        </div>
    </section>

    <!-- Dashboard Section -->
    <section class="dashboard container" id="dashboardSection">
        <div class="dashboard-header">
            <h2>Your Dashboard</h2>
            <button class="btn btn-primary" id="addListingBtn">Add New Service</button>
        </div>
        <div id="dashboardContent">
            <p>Welcome to your dashboard! Here you can manage your service listings.</p>
        </div>
    </section>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Login to Your Account</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="alert alert-danger" id="loginError"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" class="form-control" placeholder="Your email" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" class="form-control" placeholder="Your password" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
            </form>
            <p style="text-align: center; margin-top: 20px;">
                Don't have an account? <a href="#" id="switchToRegister" style="color: var(--primary);">Register</a>
            </p>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create an Account</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="alert alert-danger" id="registerError"></div>
            <form id="registerForm">
                <div class="form-group">
                    <label for="registerFirstName">First Name</label>
                    <input type="text" id="registerFirstName" class="form-control" placeholder="Your first name" required>
                </div>
                <div class="form-group">
                    <label for="registerLastName">Last Name</label>
                    <input type="text" id="registerLastName" class="form-control" placeholder="Your last name" required>
                </div>
                <div class="form-group">
                    <label for="registerCompany">Company Name (optional)</label>
                    <input type="text" id="registerCompany" class="form-control" placeholder="Your company name">
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" class="form-control" placeholder="Your email" required>
                </div>
                <div class="form-group">
                    <label for="registerPhone">Phone Number</label>
                    <input type="tel" id="registerPhone" class="form-control" placeholder="Your phone number" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Password</label>
                    <input type="password" id="registerPassword" class="form-control" placeholder="Create a password" required>
                </div>
                <div class="form-group">
                    <label for="registerUserType">I am a:</label>
                    <select id="registerUserType" class="form-control" required>
                        <option value="">Select user type</option>
                        <option value="client">Client looking for services</option>
                        <option value="professional">Service professional</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="registerPostcode">Postcode</label>
                    <input type="text" id="registerPostcode" class="form-control" placeholder="Your postcode" required>
                    <small class="form-text">Enter your postcode to find your location</small>
                </div>
                <div class="form-group" id="locationResultsContainer" style="display: none;">
                    <label>Select your location:</label>
                    <div id="locationResults" class="location-results"></div>
                </div>
                <input type="hidden" id="registerLocation" name="location">
                <button type="submit" class="btn btn-primary" style="width: 100%;">Create Account</button>
            </form>
            <p style="text-align: center; margin-top: 20px;">
                Already have an account? <a href="#" id="switchToLogin" style="color: var(--primary);">Login</a>
            </p>
        </div>
    </div>

    <!-- Add Listing Modal -->
    <div class="modal" id="addListingModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Service</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="alert alert-danger" id="listingError"></div>
            <form id="addListingForm">
                <div class="form-group">
                    <label for="listingTitle">Service Title</label>
                    <input type="text" id="listingTitle" class="form-control" placeholder="e.g., Professional Plumbing Services" required>
                </div>
                <div class="form-group">
                    <label for="listingCategory">Trade</label>
                    <select id="listingCategory" class="form-control" required>
                        <option value="">Select a trade</option>
                        <option value="Plumber">Plumber</option>
                        <option value="Electrician">Electrician</option>
                        <option value="Carpenter">Carpenter</option>
                        <option value="Painter & Decorator">Painter & Decorator</option>
                        <option value="Roofer">Roofer</option>
                        <option value="Landscaper">Landscaper</option>
                        <option value="Gardener">Gardener</option>
                        <option value="Plasterer">Plasterer</option>
                        <option value="Tiler">Tiler</option>
                        <option value="Builder">Builder</option>
                        <option value="Handyman">Handyman</option>
                        <option value="Locksmith">Locksmith</option>
                        <option value="HVAC Technician">HVAC Technician</option>
                        <option value="Appliance Repair">Appliance Repair</option>
                        <option value="Window Cleaner">Window Cleaner</option>
                        <option value="House Cleaner">House Cleaner</option>
                        <option value="Pest Control">Pest Control</option>
                        <option value="Other Trade">Other Trade</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="listingDescription">Description</label>
                    <textarea id="listingDescription" class="form-control" rows="4" placeholder="Describe your service in detail..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="listingPrice">Hourly Rate (£)</label>
                    <input type="number" id="listingPrice" class="form-control" placeholder="e.g., 30" min="0" step="0.01" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Create Service Listing</button>
            </form>
        </div>
    </div>

    <!-- Edit Listing Modal -->
    <div class="modal" id="editListingModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Service Listing</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="alert alert-danger" id="editListingError"></div>
            <form id="editListingForm">
                <input type="hidden" id="editListingId">
                <div class="form-group">
                    <label for="editListingTitle">Service Title</label>
                    <input type="text" id="editListingTitle" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="editListingCategory">Trade</label>
                    <select id="editListingCategory" class="form-control" required>
                        <option value="">Select a trade</option>
                        <option value="Plumber">Plumber</option>
                        <option value="Electrician">Electrician</option>
                        <option value="Carpenter">Carpenter</option>
                        <option value="Painter & Decorator">Painter & Decorator</option>
                        <option value="Roofer">Roofer</option>
                        <option value="Landscaper">Landscaper</option>
                        <option value="Gardener">Gardener</option>
                        <option value="Plasterer">Plasterer</option>
                        <option value="Tiler">Tiler</option>
                        <option value="Builder">Builder</option>
                        <option value="Handyman">Handyman</option>
                        <option value="Locksmith">Locksmith</option>
                        <option value="HVAC Technician">HVAC Technician</option>
                        <option value="Appliance Repair">Appliance Repair</option>
                        <option value="Window Cleaner">Window Cleaner</option>
                        <option value="House Cleaner">House Cleaner</option>
                        <option value="Pest Control">Pest Control</option>
                        <option value="Other Trade">Other Trade</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editListingDescription">Description</label>
                    <textarea id="editListingDescription" class="form-control" rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <label for="editListingPrice">Hourly Rate (£)</label>
                    <input type="number" id="editListingPrice" class="form-control" min="0" step="0.01" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Update Service Listing</button>
            </form>
        </div>
    </div>

<!-- Add these before the closing </body> tag -->
<script type="module" src="config.js"></script>
<script type="module" src="modules/utils.js"></script>
<script type="module" src="modules/modals.js"></script>
<script type="module" src="modules/api.js"></script>
<script type="module" src="modules/auth.js"></script>
<script type="module" src="modules/listings.js"></script>
<script type="module" src="script.js"></script>
    <script>
    // API Base URL
    const API_BASE_URL = window.location.origin;

    // DOM Elements
    let loginModal, registerModal, addListingModal, editListingModal;
    let loginForm, registerForm, addListingForm, editListingForm;
    let loginBtn, registerBtn, addListingBtn;
    let dashboardSection, dashboardContent;
    let loginError, registerError, listingError, editListingError;
    let switchToRegister, switchToLogin, logoutBtn;
    let userWelcome, userName, authButtons, heroBtn;

    // Initialize the application
    function initApp() {
        // Get DOM elements
        loginModal = document.getElementById('loginModal');
        registerModal = document.getElementById('registerModal');
        addListingModal = document.getElementById('addListingModal');
        editListingModal = document.getElementById('editListingModal');
        loginForm = document.getElementById('loginForm');
        registerForm = document.getElementById('registerForm');
        addListingForm = document.getElementById('addListingForm');
        editListingForm = document.getElementById('editListingForm');
        loginBtn = document.getElementById('loginBtn');
        registerBtn = document.getElementById('registerBtn');
        addListingBtn = document.getElementById('addListingBtn');
        dashboardSection = document.getElementById('dashboardSection');
        dashboardContent = document.getElementById('dashboardContent');
        loginError = document.getElementById('loginError');
        registerError = document.getElementById('registerError');
        listingError = document.getElementById('listingError');
        editListingError = document.getElementById('editListingError');
        switchToRegister = document.getElementById('switchToRegister');
        switchToLogin = document.getElementById('switchToLogin');
        logoutBtn = document.getElementById('logoutBtn');
        userWelcome = document.getElementById('userWelcome');
        userName = document.getElementById('userName');
        authButtons = document.getElementById('authButtons');
        heroBtn = document.getElementById('heroBtn');

        // Check if user is already logged in
        checkAuthStatus();
        
        // Add event listeners to buttons
        if (loginBtn) loginBtn.addEventListener('click', () => showModal(loginModal));
        if (registerBtn) registerBtn.addEventListener('click', () => showModal(registerModal));
        if (addListingBtn) addListingBtn.addEventListener('click', () => showModal(addListingModal));
        if (switchToRegister) switchToRegister.addEventListener('click', (e) => {
            e.preventDefault();
            hideAllModals();
            showModal(registerModal);
        });
        if (switchToLogin) switchToLogin.addEventListener('click', (e) => {
            e.preventDefault();
            hideAllModals();
            showModal(loginModal);
        });
        if (logoutBtn) logoutBtn.addEventListener('click', handleLogout);
        if (heroBtn) heroBtn.addEventListener('click', () => showModal(registerModal));
        
        // Form submissions
        if (loginForm) loginForm.addEventListener('submit', handleLogin);
        if (registerForm) registerForm.addEventListener('submit', handleRegister);
        if (addListingForm) addListingForm.addEventListener('submit', handleAddListing);
        if (editListingForm) editListingForm.addEventListener('submit', handleEditListing);
        
        // Close modals when clicking outside
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    hideAllModals();
                }
            });
        });
        
        // Close modals with close button
        document.querySelectorAll('.close-modal').forEach(button => {
            button.addEventListener('click', hideAllModals);
        });
        
        // Initialize location search
        initLocationSearch();
    }

    // Functions
    function showModal(modal) {
        hideAllModals();
        if (modal) {
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Prevent scrolling
        }
    }

    function hideAllModals() {
        document.querySelectorAll('.modal').forEach(modal => {
            modal.style.display = 'none';
        });
        document.body.style.overflow = 'auto'; // Re-enable scrolling
    }

    // Location search functionality
    function initLocationSearch() {
        const postcodeInput = document.getElementById('registerPostcode');
        const locationResults = document.getElementById('locationResults');
        const locationResultsContainer = document.getElementById('locationResultsContainer');
        const locationInput = document.getElementById('registerLocation');
        
        if (postcodeInput) {
            // Debounce the postcode search
            let debounceTimer;
            postcodeInput.addEventListener('input', function(e) {
                clearTimeout(debounceTimer);
                const postcode = e.target.value.trim();
                
                if (postcode.length > 4) {
                    debounceTimer = setTimeout(() => {
                        searchLocations(postcode);
                    }, 500);
                } else {
                    locationResultsContainer.style.display = 'none';
                }
            });
        }
        
        function searchLocations(postcode) {
            // Simulate API call to postcode lookup service
            // In a real application, you would use a service like Google Places API or Postcodes.io
            const mockLocations = [
                { id: 1, name: `London (${postcode})`, lat: 51.5074, lng: -0.1278 },
                { id: 2, name: `Manchester (${postcode})`, lat: 53.4808, lng: -2.2426 },
                { id: 3, name: `Birmingham (${postcode})`, lat: 52.4862, lng: -1.8904 },
                { id: 4, name: `Glasgow (${postcode})`, lat: 55
